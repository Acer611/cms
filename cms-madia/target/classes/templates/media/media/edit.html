<!--# layout("/common/layout.html",{"jsBase":"/js/media/media/"}){ -->

<form class="layui-form layui-form-pane" id="updateForm">


    <div class="layui-row">
        <div class="layui-form-item">

            <div class="layui-inline">
                <label class="layui-form-label">专辑封面图</label>
                    <div class="layui-input-inline">
                        <!--<input type="text" id="imageurl" name="imageurl"  value="${media.imageurl}"   class="layui-input" >-->
                        <img id="imageurl" name="imageurl" src="${media.imageurl}" style="width: 200px; height: 200px">
                    </div>
            </div>

            <div class="layui-inline">
                <div class="layui-upload">
                    <button type="button" class="layui-btn" id="test1">上传图片</button>
                    <div class="layui-upload-list">
                        <!--预览图片-->
                        <img class="layui-upload-img" id="demo1">
                        <!--提示上传信息-->
                        <p id="demoText"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="layui-row">
        <label class="layui-form-label">添加分类</label>
            <div class="layui-input-inline">
                <select name="courseTemplate.levelId" class="state">
                    <option value="">请选教育程度</option>
                </select>
            </div>

            <div class="layui-input-inline">
                <select name="courseTemplate.gradeId" class="state">
                    <option value="">请选授课年级</option>
                </select>
            </div>

            <div class="layui-input-inline">
                <select name="courseTemplate.subjectId" class="state">
                    <option value="">请选授课科目</option>
                </select>
            </div>

    </div>

    <div class="layui-row">
        <label class="layui-form-label">专辑标签</label>
        <div class="layui-input-block">
            <input type="text" id="tags" name="tags"
                    class="layui-input" value="${media.tags}">
        </div>

    </div>

    <div class="layui-row">
            <div>
                <label class="layui-form-label">专辑介绍</label>
            </div>

            <div>
                <textarea id="note" name="note"  class="layui-input"  lay-verify="note"  >${media.note}</textarea>
            </div>

    </div>


	<!-- 业务对象须有hidden字段，保存delFlag和version字段-->
    <input type="hidden" name="mediaguid" value=${media.mediaguid} />
    <layui:submitButtons id="updateButton" />
</form>
<!--#} -->
<script>
layui.use(['edit'], function(){
    var mediaEdit = layui.edit
    mediaEdit.init();
});
</script>

<script>
    layui.use('layedit', function(){
        var layedit = layui.layedit;
        $ = layui.jquery;
        form = layui.form;

        layedit.set({
            uploadImage: {
                url: '' //接口url
                ,type: '' //默认post
            }
        });
        var note =   layedit.build('note'); //建立编辑器

        form.verify({
            note:function () {
                layedit.sync(note);
            }
        });

    });
</script>

<script>
    layui.use(['upload','jquery'], function(){
        var $ = layui.$,
            upload = layui.upload;

        //普通图片上传
        var uploadInst = upload.render({
            elem: '#test1'
            ,url: '/upload/'
            ,before: function(obj){//文件上传前的回调
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                    $('#imageurl').attr('src', result); //图片链接（base64）直接将图片地址赋值给img的src属性
                });
            }
            ,done: function(res){
                //如果上传失败
                if(res.code > 0){
                    return layer.msg('上传失败');
                }
                //上传成功
            }
            ,error: function(){
                //演示失败状态，并实现重传
                var demoText = $('#demoText');
                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                demoText.find('.demo-reload').on('click', function(){
                    uploadInst.upload();
                });
            }
        });

    });
</script>
<script>
    layui.use(['layer', 'jquery', 'form'], function () {
        var layer = layui.layer,
            $ = layui.jquery,
            form = layui.form;
        var url =  Common.ctxPath + '/category/mediacategory/listByCode.json'; //数据请求地址
        var level = "";
        var grade = "";
        var subject = "";
        getJSON(url + "?categoryCode=00040002", $("select[name='courseTemplate.levelId']").closest("div")); //初始化第一个元素
        var type;
        form.on('select(state)', function (data) { //进行监听 看元素是否变化，获取下一个下拉框数据
            $that = $(data.elem);
            type = data.elem.name;
            var urls = "";
            if (type == "courseTemplate.levelId") {
                urls = url + "?treeType=2&levelId=" + data.value;
            } else if (type == "courseTemplate.gradeId") {
                var levelId = $("select[name='courseTemplate.levelId']").val();
                urls = url + "?treeType=3&levelId=" + levelId + "&gradeId=" + data.value;
            }
            getJSON(urls, $that.closest("div").next());
        });

        function getJSON(urls, even) {
            $.getJSON(urls, function (json) {
                var pid = 0;
                var name = even.find("select").attr("name");
                var select = "<select name=\"" + name + "\" lay-filter=\"state\">";
                select += "<option value=\"0\">请选择 </option>";
                $(json).each(function () {
                    select += "<option value=\"" + this.id + "\"";
                    if (level == this.nameCn || grade == this.nameCn || subject == this.nameCn) {
                        select += " selected=\"selected\" ";
                        pid = this.id;
                    }
                    select += ">" + this.nameCn + "</option>";
                });
                select += "</select>";
                even.html(select);
                var nextName = even.next().find("select").attr("name");
                even.next().html("<select name=\"" + nextName + "\" lay-filter=\"state\"><option value=\"0\">请选择 </option></select>");
                form.render('select');
                if (pid != 0) {
                    var urls = "";
                    if (name == "courseTemplate.levelId") {
                        urls = url + "?treeType=2&levelId=" + pid;
                    } else if (name == "courseTemplate.gradeId") {
                        var levelId = $("select[name='courseTemplate.levelId']").val();
                        urls = url + "?treeType=3&levelId=" + levelId + "&gradeId=" + pid;
                    }
                    getJSON(urls, even.next());
                }
            });
        }
    });
</script>

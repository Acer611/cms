<!--# layout("/common/layout.html",{"jsBase":"/js/media/media/"}){ -->

<form class="layui-form layui-form-pane" id="updateForm">


    <div class="layui-row">
        <div class="layui-form-item">

            <div class="layui-inline">
                <label class="layui-form-label">专辑封面图</label>
                    <div class="layui-input-inline">
                        <!--<input type="text" id="imageurl" name="imageurl"  value="${media.imageurl}"   class="layui-input" >-->
                        <img id="imageurl" name="imageurl" src="${media.imageurl}" style="width: 200px; height: 200px">
                    </div>
            </div>

            <div class="layui-inline">
                <div class="layui-upload">
                    <button type="button" class="layui-btn" id="test1">上传图片</button>
                    <div class="layui-upload-list">
                        <!--预览图片-->
                        <img class="layui-upload-img" id="demo1">
                        <!--提示上传信息-->
                        <p id="demoText"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="layui-row">
        <div style="margin: 50px auto; ">
            <form class="layui-form">
                <div class="layui-form-item">
                    <label class="layui-form-label">添加分类</label>
                    <div class="layui-input-inline">
                        <select  id = "assetstype" name="assetstype" lay-filter="assetstype">
                            <option value="">一级分类</option>
                        </select>
                    </div>
                    <div class="layui-input-inline" style="display: none;">
                        <select id = "subtype" name="subtype" lay-filter="subtype">
                            <option value="">二级分类</option>
                        </select>
                    </div>

                </div>
            </form>
        </div>

    </div>



    <div class="layui-row">
            <div>
                <label class="layui-form-label">专辑介绍</label>
            </div>

            <div>
                <textarea id="note" name="note"  class="layui-input"  lay-verify="note"  >${media.note}</textarea>
            </div>

    </div>


	<!-- 业务对象须有hidden字段，保存delFlag和version字段-->
    <input type="hidden" name="mediaguid" value=${media.mediaguid} />
    <layui:submitButtons id="updateButton" />
</form>
<!--#} -->
<script>
layui.use(['edit'], function(){
    var mediaEdit = layui.edit
    mediaEdit.init();
});
</script>

<script>
    layui.use('layedit', function(){
        var layedit = layui.layedit;
        $ = layui.jquery;
        form = layui.form;

        layedit.set({
            uploadImage: {
                url: '' //接口url
                ,type: '' //默认post
            }
        });
        var note =   layedit.build('note'); //建立编辑器

        form.verify({
            note:function () {
                layedit.sync(note);
            }
        });

    });
</script>

<script>
    layui.use(['upload','jquery'], function(){
        var $ = layui.$,
            upload = layui.upload;

        //普通图片上传
        var uploadInst = upload.render({
            elem: '#test1'
            ,url: '/upload/'
            ,before: function(obj){//文件上传前的回调
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                    $('#imageurl').attr('src', result); //图片链接（base64）直接将图片地址赋值给img的src属性
                });
            }
            ,done: function(res){
                //如果上传失败
                if(res.code > 0){
                    return layer.msg('上传失败');
                }
                //上传成功
            }
            ,error: function(){
                //演示失败状态，并实现重传
                var demoText = $('#demoText');
                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                demoText.find('.demo-reload').on('click', function(){
                    uploadInst.upload();
                });
            }
        });



        function getAssetstype(){
            $('#assetstype').empty();
            $('#assetstype').append("<option value=''>选择资产类型</option>");
            //查询资产父类型
            $.get(Common.ctxPath + '/category/mediacategory/listByCode.json?categoryCode=' +'00040002',
                function(result){
                    for (var i in result){
                        var optAss="<option value='"+result[i].id+"'>"+result[i].value+"</option>";
                        $('#assetstype').append(optAss);
                    }
                    form.on('select(assetsfilter)',function(date){
                        getSubtype(date.value);
                    })
                    form.render('select');
                })
        }
        function getSubtype(assetstype){
            $('#subtype').empty();
            $('#subtype').append("<option value=''>选择资产子类型</option>");
            //查询资产子类型
            $.post(Common.ctxPath + '/category/mediacategory/listByCode.json?categoryCode=',{categoryCode:assetstype},
                function(data){
                    for(var k in data){
                        var optSub="<option value='"+data[k].id+"'>"+data[k].value+"</option>";
                        $("#subtype").append(optSub);
                    }
                    form.on('select(assetsfilter)',function(date){
                        //这里继续下一级联动
                        //getSubtype(date.value);
                    })
                    form.render('select');
                })

        }



    });
</script>
